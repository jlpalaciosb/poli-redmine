{% extends 'layout/layout.html' %}
{% load static %}

{% block extracss %}
    <link rel="stylesheet" href="{% static 'libs/jquery/datatables/dist/css/dataTables.bootstrap.css' %}" type="text/css" />
{% endblock %}

{% block content %}

    <div id="popup" class="modal fade" role="dialog">
    </div>

    {% block titulo %}
        <div class="bg-light lter b-b wrapper-md col-md-12">
            <h1 class="m-n font-thin h3 col-lg-6">{{ titulo }}</h1>
            {% block periodo %}
                {{ block.super }}
            {% endblock %}
        </div>

    {% endblock %}

    {% block breadcrumbs %}
        {{ block.super }}
    {% endblock %}



    <div class="wrapper-md">

        {% block detail %}

        {% endblock %}

        {% block action_buttons %}
            {% if crear_buttom %}
                {% if perms.IRP.add_contribuyente %}
                    {% if not contribuyente %}
                        {% block create_buttom %}
                            <div class="row">
                                <div class="col-lg-12 col-md-12 col-xs-12">
                                    <a  href="{{ crear_url }}">
                                        <button class="pull-right btn m-b-xs btn-success btn-addon">
                                            <i class="fa fa-plus"></i>
                                            {{ crear_text_buttom }}
                                        </button>
                                    </a>
                                </div>
                            </div>
                        {% endblock %}
                    {% endif %}
                {% endif %}


                    {% if contribuyente %}

                        <div class="row">
                            <div class="col-lg-12 col-md-12 col-xs-12">

                            {% if crear_egreso_text_buttom or crear_ingreso_text_buttom %}

                                <div class="btn-group dropdown pull-right">
                                      <button class="btn btn-default" data-toggle="dropdown">Importar datos <span class="caret"></span></button>
                                      <ul class="dropdown-menu">
                                          {% if perms.IRP.add_ingreso %}
                                            <li>
                                                <a onclick="return open_modal('{{ importar_ingresos_url }}')" href>Importar Ingresos</a>
                                            </li>
                                          {% endif %}
                                          {% if perms.IRP.add_egreso %}
                                            <li>
                                                <a onclick="return open_modal('{{ importar_egresos_url }}')" href>Importar Egresos</a>
                                            </li>
                                          {% endif %}
                                            <li>
                                                <a href="{{ pdf_generate_formulario104v3_url }}">Imprimir Formulario 104 V3</a>
                                            </li>
                                      </ul>
                                </div>


                            
                                {% if perms.IRP.add_egreso %}
                                    <a  href="{{ crear_egreso_url }}" >
                                        <button style="margin-right: 10px" class="pull-right btn m-b-xs btn-success btn-addon">
                                            <i class="fa fa-plus"></i>
                                            {{ crear_egreso_text_buttom }}
                                        </button>
                                    </a>
                                {% endif %}
                                {% if perms.IRP.add_ingreso %}
                                    <a  href="{{ crear_ingreso_url }}">
                                        <button style="margin-right: 10px" class="pull-right btn m-b-xs btn-success btn-addon">
                                            <i class="fa fa-plus"></i>
                                            {{ crear_ingreso_text_buttom }}
                                        </button>
                                    </a>
                                {% endif %}
                                
                            {% endif %}
                            
                            {% if crear_prestamo_text_buttom %}
                                {% if perms.IRP.add_prestamo %}
                                    <a  href="{{ crear_prestamo_url }}">
                                        <button style="margin-right: 10px" class="pull-right btn m-b-xs btn-success btn-addon">
                                            <i class="fa fa-plus"></i>
                                            {{ crear_prestamo_text_buttom }}
                                        </button>
                                    </a>
                                {% endif %}
                            {% endif %}

                            {% if crear_resultado_text_buttom %}
                                {% if perms.IRP.add_resultado %}
                                    <a  href="{{ crear_resultado_url }}">
                                        <button style="margin-right: 10px" class="pull-right btn m-b-xs btn-success btn-addon">
                                            <i class="fa fa-plus"></i>
                                            {{ crear_resultado_text_buttom }}
                                        </button>
                                    </a>
                                {% endif %}
                            {% endif %}


                            </div>
                        </div>

                    {% endif %}

            {% endif %}
        {% endblock %}

        {% if contribuyente %}
            <div class="tab-container">
                <ul class="nav nav-tabs">
                    {% if ingresos_text_tab %}
                        <li class="active col-lg-6 col-md-6 col-xs-6"><a data-toggle="tab" data-target="#tab_ingresos">{{ ingresos_text_tab }}</a></li>
                        <li class="col-lg-6 col-md-6 col-xs-6"><a data-toggle="tab" data-target="#tab_egresos">{{ egregsos_text_tab }}</a></li>
                    {% endif %}
                    {% if prestamos_text_tab %}
                        <li class="active col-lg-12 col-md-12 col-xs-12"><a data-toggle="tab" data-target="#tab_prestamos">{{ prestamos_text_tab }}</a></li>
                    {% endif %}
                    {% if resultados_text_tab %}
                        <li class="active col-lg-12 col-md-12 col-xs-12"><a data-toggle="tab" data-target="#tab_prestamos">{{ resultados_text_tab }}</a></li>
                    {% endif %}
                </ul>
                <div class="tab-content">
                  <div class="tab-pane active" id="tab_1">
                    <ul class="list-group no-borders pull-in m-b-none">
                      <li class="list-group-item">
        {% endif %}
                        <div class="row">
                            <div class="col-xs-12 col-md-12 col-lg-12">
                                <div class="panel">
                                    <div class="panel-body table-responsive">
                                        {% block results %}
                                            <div class="row">
                                                <table class="table table-hover table-responsive datatable" style="width: 100%">
                                                    <thead>
                                                    {% for columna in nombres_columnas %}
                                                        <th>{{ columna }}</th>
                                                    {% endfor %}
                                                    </thead>
                                                    <tbody>
                                                    </tbody>
                                                </table>
                                            </div>
                                        {% endblock %}
                                    </div>
                                </div>
                            </div>
                        </div>

        {% if contribuyente %}
                      </li>
                    </ul>
                  </div>
                </div>
            </div>
        {% endif %}


    </div>

{% endblock %}

{% block extrajs %}
    <script type="text/javascript" src="{% static 'libs/jquery/datatables/dist/js/datatables.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'libs/jquery/datatables/dist/js/dataTables.bootstrap.min.js' %}"></script>

    <script type="text/javascript">
        $(document).ready(function() {
            var table = $('.datatable').DataTable({
                stateSave: true,
                "order": [[ {{ order.0 }}, '{{order.1 }}' ]],
                "columnDefs": [
                    {"visible": false, "targets": 0},
                    {"width": "10%", "targets": 1}
                ],
                {% if not contribuyente %}
                   'createdRow': function( row, data, dataIndex) {
                       var url = '{{ datatable_row_link }}';
                       url = url.replace(1, data[0]);
                       $(row).attr('data-href', url);
                       $(row).attr('class', "tr-href");
                   },
                {% endif %}

                {% if contribuyente %}
                   'createdRow': function( row, data, dataIndex) {
                       var url = '{{ datatable_row_link }}';

                       var ingresos_string_url = url.split('/contribuyentes/')[1];
                       var vector = ingresos_string_url.split('/');
                       vector[2] = data[0];
                       var url_string_vector = vector.join('/');

                       url = '/contribuyentes/' + url_string_vector;
                       $(row).attr('data-href', url);
                       $(row).attr('class', "tr-href");
                   },
                {% endif %}

                "processing": true,
                "serverSide": true,
                "ajax": '{{ list_json }}',
                language: {
                    url: "{% static 'libs/jquery/datatables/dist/localization/Spanish.json' %}"
                }
            });

            $('.datatable tbody').on('click', 'tr', function () {
                if($(this).data("href") !== undefined){
                    window.document.location = $(this).data("href");
                }
            });
        });
    </script>

    <script type="text/javascript" src="{% static 'js/modals.js' %}"></script>
{% endblock %}